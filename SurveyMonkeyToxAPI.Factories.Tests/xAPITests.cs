using Microsoft.VisualStudio.TestTools.UnitTesting;
using Newtonsoft.Json.Linq;
using SurveyMonkeyToxAPI.Models;
using System.Collections.Generic;

namespace SurveyMonkeyToxAPI.Factories.Tests
{
    [TestClass]
    public class xAPITests
    {
        private string _surveyJSON = "{ \"response_count\": 1, \"page_count\": 2, \"buttons_text\": { \"done_button\": \"Done\", \"prev_button\": \"Prev\", \"exit_button\": \"Exit this survey\", \"next_button\": \"Next\" }, \"custom_variables\": {}, \"nickname\": \"\", \"id\": \"29046621\", \"question_count\": 10, \"category\": \"industry_specific\", \"preview\": \"http://www.surveymonkey.com/r/Preview/?sm=jY7kfxZZ9WO_2BlVJIy8NqOzOqGi5vKBBmYy7K2QB3jFI_3D\", \"is_owner\": true, \"language\": \"en\", \"date_modified\": \"2016-12-09T13:09:00\", \"title\": \"Test Survey\", \"analyze_url\": \"http://www.surveymonkey.com/analyze/H5kuGlfExUEWdjnqay7jS_2FG_2FXK4n0pa_2FUS7uwvGGgOU_3D\", \"pages\": [ { \"href\": \"https://api.surveymonkey.net/v3/surveys/29046621/pages/124139920\", \"description\": \"\", \"questions\": [ { \"sorting\": null, \"family\": \"single_choice\", \"subtype\": \"vertical\", \"required\": null, \"answers\": { \"choices\": [ { \"visible\": true, \"text\": \"Answer 1\", \"position\": 1, \"id\": \"10808578431\" }, { \"visible\": true, \"text\": \"Answer 2\", \"position\": 2, \"id\": \"10808578432\" }, { \"visible\": true, \"text\": \"Answer 3\", \"position\": 3, \"id\": \"10808578433\" }, { \"visible\": true, \"text\": \"Answer 4\", \"position\": 4, \"id\": \"10808578434\" } ] }, \"visible\": true, \"href\": \"https://api.surveymonkey.net/v3/surveys/29046621/pages/124139920/questions/1047686238\", \"headings\": [ { \"heading\": \"This is a multiple choice\" } ], \"position\": 1, \"validation\": null, \"id\": \"1047686238\", \"forced_ranking\": false }, { \"display_options\": { \"middle_label\": \"\", \"show_display_number\": true, \"display_subtype\": \"star\", \"right_label\": \"\", \"display_type\": \"emoji\", \"custom_options\": { \"color\": \"#f5a623\", \"option_set\": [] }, \"left_label\": \"\" }, \"sorting\": null, \"family\": \"matrix\", \"subtype\": \"rating\", \"required\": null, \"answers\": { \"rows\": [ { \"visible\": true, \"text\": \"\", \"position\": 1, \"id\": \"10808578479\" } ], \"choices\": [ { \"description\": \"\", \"weight\": 1, \"id\": \"10808578480\", \"visible\": true, \"is_na\": false, \"text\": \"\", \"position\": 1 }, { \"description\": \"\", \"weight\": 2, \"id\": \"10808578481\", \"visible\": true, \"is_na\": false, \"text\": \"\", \"position\": 2 }, { \"description\": \"\", \"weight\": 3, \"id\": \"10808578482\", \"visible\": true, \"is_na\": false, \"text\": \"\", \"position\": 3 }, { \"description\": \"\", \"weight\": 4, \"id\": \"10808578483\", \"visible\": true, \"is_na\": false, \"text\": \"\", \"position\": 4 }, { \"description\": \"\", \"weight\": 5, \"id\": \"10808578484\", \"visible\": true, \"is_na\": false, \"text\": \"\", \"position\": 5 } ] }, \"visible\": true, \"href\": \"https://api.surveymonkey.net/v3/surveys/29046621/pages/124139920/questions/1047686242\", \"headings\": [ { \"heading\": \"This is a star rating\" } ], \"position\": 2, \"validation\": null, \"id\": \"1047686242\", \"forced_ranking\": false }, { \"sorting\": null, \"family\": \"matrix\", \"subtype\": \"rating\", \"required\": null, \"answers\": { \"rows\": [ { \"visible\": true, \"text\": \"Row 1\", \"position\": 1, \"id\": \"10808579317\" }, { \"visible\": true, \"text\": \"Row 2\", \"position\": 2, \"id\": \"10808579318\" }, { \"visible\": true, \"text\": \"Row 3\", \"position\": 3, \"id\": \"10808579319\" } ], \"choices\": [ { \"description\": \"\", \"weight\": 1, \"id\": \"10808579320\", \"visible\": true, \"is_na\": false, \"text\": \"Column 1\", \"position\": 1 }, { \"description\": \"\", \"weight\": 2, \"id\": \"10808579321\", \"visible\": true, \"is_na\": false, \"text\": \"Column 2\", \"position\": 2 }, { \"description\": \"\", \"weight\": 3, \"id\": \"10808579322\", \"visible\": true, \"is_na\": false, \"text\": \"Column 3\", \"position\": 3 }, { \"description\": \"\", \"weight\": 4, \"id\": \"10808579323\", \"visible\": true, \"is_na\": false, \"text\": \"Column 4\", \"position\": 4 } ] }, \"visible\": true, \"href\": \"https://api.surveymonkey.net/v3/surveys/29046621/pages/124139920/questions/1047686363\", \"headings\": [ { \"heading\": \"This is a matrix scale\" } ], \"position\": 3, \"validation\": null, \"id\": \"1047686363\", \"forced_ranking\": false }, { \"sorting\": null, \"family\": \"matrix\", \"subtype\": \"ranking\", \"required\": null, \"answers\": { \"rows\": [ { \"visible\": true, \"text\": \"Row 1\", \"position\": 1, \"id\": \"10808580133\" }, { \"visible\": true, \"text\": \"Row 2\", \"position\": 2, \"id\": \"10808580134\" }, { \"visible\": true, \"text\": \"Row 3\", \"position\": 3, \"id\": \"10808580135\" } ], \"choices\": [ { \"description\": \"\", \"weight\": 1, \"id\": \"10808580136\", \"visible\": true, \"is_na\": false, \"text\": \"1\", \"position\": 1 }, { \"description\": \"\", \"weight\": 2, \"id\": \"10808580137\", \"visible\": true, \"is_na\": false, \"text\": \"2\", \"position\": 2 }, { \"description\": \"\", \"weight\": 3, \"id\": \"10808580138\", \"visible\": true, \"is_na\": false, \"text\": \"3\", \"position\": 3 } ] }, \"visible\": true, \"href\": \"https://api.surveymonkey.net/v3/surveys/29046621/pages/124139920/questions/1047686456\", \"headings\": [ { \"heading\": \"This is a ranking\" } ], \"position\": 4, \"validation\": null, \"id\": \"1047686456\", \"forced_ranking\": false }, { \"display_options\": { \"middle_label\": \"\", \"show_display_number\": true, \"display_subtype\": \"\", \"right_label\": \"100\", \"display_type\": \"slider\", \"custom_options\": { \"starting_position\": 0, \"option_set\": [], \"step_size\": 1 }, \"left_label\": \"0\" }, \"sorting\": null, \"family\": \"open_ended\", \"subtype\": \"single\", \"required\": null, \"visible\": true, \"href\": \"https://api.surveymonkey.net/v3/surveys/29046621/pages/124139920/questions/1047686579\", \"headings\": [ { \"heading\": \"This is a slider\" } ], \"position\": 5, \"validation\": { \"sum_text\": \"\", \"min\": \"0\", \"text\": \"Please enter a whole number between {0} and {1}.\", \"sum\": null, \"max\": \"100\", \"type\": \"integer\" }, \"id\": \"1047686579\", \"forced_ranking\": false }, { \"sorting\": null, \"family\": \"open_ended\", \"subtype\": \"single\", \"required\": null, \"visible\": true, \"href\": \"https://api.surveymonkey.net/v3/surveys/29046621/pages/124139920/questions/1047686621\", \"headings\": [ { \"heading\": \"This is a single textbox\" } ], \"position\": 6, \"validation\": null, \"id\": \"1047686621\", \"forced_ranking\": false }, { \"sorting\": null, \"family\": \"open_ended\", \"subtype\": \"multi\", \"required\": null, \"answers\": { \"rows\": [ { \"visible\": true, \"text\": \"Label 1\", \"position\": 1, \"id\": \"10808582238\" }, { \"visible\": true, \"text\": \"Label 2\", \"position\": 2, \"id\": \"10808582239\" }, { \"visible\": true, \"text\": \"Label 3\", \"position\": 3, \"id\": \"10808582240\" } ] }, \"visible\": true, \"href\": \"https://api.surveymonkey.net/v3/surveys/29046621/pages/124139920/questions/1047686677\", \"headings\": [ { \"heading\": \"This is a multiple textbox\" } ], \"position\": 7, \"validation\": null, \"id\": \"1047686677\", \"forced_ranking\": false }, { \"sorting\": null, \"family\": \"open_ended\", \"subtype\": \"essay\", \"required\": null, \"visible\": true, \"href\": \"https://api.surveymonkey.net/v3/surveys/29046621/pages/124139920/questions/1047686717\", \"headings\": [ { \"heading\": \"This is a comment box\" } ], \"position\": 8, \"validation\": null, \"id\": \"1047686717\", \"forced_ranking\": false }, { \"sorting\": null, \"family\": \"multiple_choice\", \"subtype\": \"vertical\", \"required\": null, \"answers\": { \"choices\": [ { \"visible\": true, \"text\": \"tester\", \"position\": 1, \"id\": \"10808625071\" }, { \"visible\": true, \"text\": \"tester 2\", \"position\": 2, \"id\": \"10808625072\" } ] }, \"visible\": true, \"href\": \"https://api.surveymonkey.net/v3/surveys/29046621/pages/124139920/questions/1047692178\", \"headings\": [ { \"heading\": \"Multiple choice question\" } ], \"position\": 9, \"validation\": null, \"id\": \"1047692178\", \"forced_ranking\": false } ], \"title\": \"Page 1\", \"position\": 1, \"id\": \"124139920\", \"question_count\": 9 }, { \"href\": \"https://api.surveymonkey.net/v3/surveys/29046621/pages/99241017\", \"description\": \"\", \"questions\": [ { \"sorting\": null, \"family\": \"datetime\", \"subtype\": \"both\", \"required\": null, \"answers\": { \"rows\": [ { \"visible\": true, \"text\": \"Date / Time\", \"position\": 1, \"id\": \"10809179251\" } ] }, \"visible\": true, \"href\": \"https://api.surveymonkey.net/v3/surveys/29046621/pages/99241017/questions/1047771116\", \"headings\": [ { \"heading\": \"This is a date Question\" } ], \"position\": 1, \"validation\": { \"sum_text\": \"\", \"min\": null, \"text\": \"Please enter a valid date.\", \"sum\": null, \"max\": null, \"type\": \"date_us\" }, \"id\": \"1047771116\", \"forced_ranking\": false } ], \"title\": \"Page 2\", \"position\": 2, \"id\": \"99241017\", \"question_count\": 1 } ], \"summary_url\": \"http://www.surveymonkey.com/summary/H5kuGlfExUEWdjnqay7jS_2FG_2FXK4n0pa_2FUS7uwvGGgOU_3D\", \"href\": \"https://api.surveymonkey.net/v3/surveys/29046621\", \"date_created\": \"2012-06-25T14:02:00\", \"collect_url\": \"http://www.surveymonkey.com/collect/list?sm=H5kuGlfExUEWdjnqay7jS_2FG_2FXK4n0pa_2FUS7uwvGGgOU_3D\", \"edit_url\": \"http://www.surveymonkey.com/create/?sm=H5kuGlfExUEWdjnqay7jS_2FG_2FXK4n0pa_2FUS7uwvGGgOU_3D\" }";
        private string _responseJSON = "{ \"per_page\": 50, \"total\": 3, \"data\": [ { \"total_time\": 9, \"href\": \"https://api.surveymonkey.net/v3/surveys/29046621/responses/1891987046\", \"custom_variables\": {}, \"ip_address\": \"67.70.110.169\", \"id\": \"1891987046\", \"logic_path\": {}, \"date_modified\": \"2012-06-25T15:46:36+00:00\", \"response_status\": \"completed\", \"custom_value\": \"\", \"analyze_url\": \"http://www.surveymonkey.com/analyze/browse/H5kuGlfExUEWdjnqay7jS_2FG_2FXK4n0pa_2FUS7uwvGGgOU_3D?respondent_id=1891987046\", \"pages\": [ { \"id\": \"124139920\", \"questions\": [] }, { \"id\": \"99241017\", \"questions\": [] } ], \"page_path\": [], \"recipient_id\": \"719866789\", \"collector_id\": \"28126803\", \"date_created\": \"2012-06-25T15:46:27+00:00\", \"survey_id\": \"29046621\", \"collection_mode\": \"default\", \"edit_url\": \"http://www.surveymonkey.com/r/?sm=dUMiKtkPga1dOMAs4NlVB7057UizeU9NRsQAYI9qWamd_2B55IPvW7x8tj4DI5XSiQ\", \"metadata\": { \"contact\": { \"email\": { \"type\": \"string\", \"value\": \"gareth.marland@gmail.com\" } } } }, { \"total_time\": 78, \"href\": \"https://api.surveymonkey.net/v3/surveys/29046621/responses/5132328075\", \"custom_variables\": {}, \"ip_address\": \"99.230.163.30\", \"id\": \"5132328075\", \"logic_path\": {}, \"date_modified\": \"2016-12-09T13:10:42+00:00\", \"response_status\": \"completed\", \"custom_value\": \"\", \"analyze_url\": \"http://www.surveymonkey.com/analyze/browse/H5kuGlfExUEWdjnqay7jS_2FG_2FXK4n0pa_2FUS7uwvGGgOU_3D?respondent_id=5132328075\", \"pages\": [ { \"id\": \"124139920\", \"questions\": [ { \"id\": \"1047686238\", \"answers\": [ { \"choice_id\": \"10808578432\" } ] }, { \"id\": \"1047686242\", \"answers\": [ { \"choice_id\": \"10808578483\", \"row_id\": \"10808578479\" } ] }, { \"id\": \"1047686363\", \"answers\": [ { \"choice_id\": \"10808579321\", \"row_id\": \"10808579317\" }, { \"choice_id\": \"10808579322\", \"row_id\": \"10808579318\" }, { \"choice_id\": \"10808579323\", \"row_id\": \"10808579319\" } ] }, { \"id\": \"1047686456\", \"answers\": [ { \"choice_id\": \"10808580137\", \"row_id\": \"10808580133\" }, { \"choice_id\": \"10808580136\", \"row_id\": \"10808580134\" }, { \"choice_id\": \"10808580138\", \"row_id\": \"10808580135\" } ] }, { \"id\": \"1047686579\", \"answers\": [ { \"text\": \"43\" } ] }, { \"id\": \"1047686621\", \"answers\": [ { \"text\": \"Tester tester tester\" } ] }, { \"id\": \"1047686677\", \"answers\": [ { \"text\": \"test 1\", \"row_id\": \"10808582238\" }, { \"text\": \"test 2 \", \"row_id\": \"10808582239\" }, { \"text\": \"test 3\", \"row_id\": \"10808582240\" } ] }, { \"id\": \"1047686717\", \"answers\": [ { \"text\": \"this is my comment\" } ] }, { \"id\": \"1047692178\", \"answers\": [ { \"choice_id\": \"10808625071\" } ] } ] }, { \"id\": \"99241017\", \"questions\": [ { \"id\": \"1047771116\", \"answers\": [ { \"text\": \"02/15/2016 02:23 AM\", \"row_id\": \"10809179251\" } ] } ] } ], \"page_path\": [], \"recipient_id\": \"\", \"collector_id\": \"28126795\", \"date_created\": \"2016-12-09T13:09:24+00:00\", \"survey_id\": \"29046621\", \"collection_mode\": \"default\", \"edit_url\": \"http://www.surveymonkey.com/r/?sm=uhZATmV5fHVV2aP9C_2FyzPo6T2sHZFSImYOB2EjZwAUv40iDPhhKnKk4kIUNT_2FFbt\", \"metadata\": {} }, { \"total_time\": 190, \"href\": \"https://api.surveymonkey.net/v3/surveys/29046621/responses/5132338980\", \"custom_variables\": {}, \"ip_address\": \"99.230.163.30\", \"id\": \"5132338980\", \"logic_path\": {}, \"date_modified\": \"2016-12-09T13:19:34+00:00\", \"response_status\": \"completed\", \"custom_value\": \"\", \"analyze_url\": \"http://www.surveymonkey.com/analyze/browse/H5kuGlfExUEWdjnqay7jS_2FG_2FXK4n0pa_2FUS7uwvGGgOU_3D?respondent_id=5132338980\", \"pages\": [ { \"id\": \"124139920\", \"questions\": [ { \"id\": \"1047686238\", \"answers\": [ { \"choice_id\": \"10808578432\" } ] }, { \"id\": \"1047686242\", \"answers\": [ { \"choice_id\": \"10808578484\", \"row_id\": \"10808578479\" } ] }, { \"id\": \"1047686363\", \"answers\": [ { \"choice_id\": \"10808579322\", \"row_id\": \"10808579317\" }, { \"choice_id\": \"10808579323\", \"row_id\": \"10808579318\" }, { \"choice_id\": \"10808579321\", \"row_id\": \"10808579319\" } ] }, { \"id\": \"1047686456\", \"answers\": [ { \"choice_id\": \"10808580136\", \"row_id\": \"10808580133\" }, { \"choice_id\": \"10808580137\", \"row_id\": \"10808580134\" }, { \"choice_id\": \"10808580138\", \"row_id\": \"10808580135\" } ] }, { \"id\": \"1047686579\", \"answers\": [ { \"text\": \"89\" } ] }, { \"id\": \"1047686621\", \"answers\": [ { \"text\": \"Another response single\" } ] }, { \"id\": \"1047686677\", \"answers\": [ { \"text\": \"first\", \"row_id\": \"10808582238\" }, { \"text\": \"second\", \"row_id\": \"10808582239\" }, { \"text\": \"third\", \"row_id\": \"10808582240\" } ] }, { \"id\": \"1047686717\", \"answers\": [ { \"text\": \"gareth.marland@gmail.com\" } ] }, { \"id\": \"1047692178\", \"answers\": [ { \"choice_id\": \"10808625071\" }, { \"choice_id\": \"10808625072\" } ] } ] }, { \"id\": \"99241017\", \"questions\": [ { \"id\": \"1047771116\", \"answers\": [ { \"text\": \"09/03/2016 08:54 AM\", \"row_id\": \"10809179251\" } ] } ] } ], \"page_path\": [], \"recipient_id\": \"\", \"collector_id\": \"28126795\", \"date_created\": \"2016-12-09T13:16:23+00:00\", \"survey_id\": \"29046621\", \"collection_mode\": \"default\", \"edit_url\": \"http://www.surveymonkey.com/r/?sm=fq7EPquMVWlUVuBtBCfDYetcwNcCoBzc4LzpUUQD7Y8VzTGgqlwOhAWPq3CesHpP\", \"metadata\": {} } ], \"page\": 1, \"links\": { \"self\": \"https://api.surveymonkey.net/v3/surveys/29046621/responses/bulk?page=1&per_page=50\" } }";

        [TestMethod]
        public void TestValidxAPIResponses()
        {
            Survey survey = new Survey(_surveyJSON);

            SurveyResponses surveyResponses = new SurveyResponses(_responseJSON);

            IList<string> emailQuestionIds = surveyResponses.GetEmailQuestionIds();

            IList<Question> questions = survey.GetValidQuestions(emailQuestionIds);

            Assert.AreEqual(9, questions.Count);

            IList<Response> responses = surveyResponses.GetAllValidResponses();

            Assert.AreEqual(2, responses.Count);

            for (int i=0; i<responses.Count; i++)
            { 
                foreach (Question question in questions)
                {
                    if (i == 0)
                    {
                        JObject questionResponse = responses[i].GetQuestion(question.Id);

                        Assert.AreEqual(questionResponse.Count, 0);
                    }
                    else
                    {
                        JObject questionResponse = responses[i].GetQuestion(question.Id);

                        JObject questionxAPIStatement = question.GetxAPIStatement(responses[i].Email, questionResponse);

                        Assert.AreNotEqual(questionResponse.Count, 0);
                    }
                }
            }
        }
    }
}
